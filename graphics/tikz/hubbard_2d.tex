%! TeX root = ../../main.tex
% chktex-file 8

\def\nsites{3}
\def\len{3mm}
\def\wdth{3mm}
\def\lwdth{0.75mm}
\def\spinsep{0.1}

\newcommand\nup[2]
{
    \draw [red, {Latex[length=\len, width=\wdth]}-, line width=\lwdth]
    ({#2*2}, {0.6-#1*2}) -- ({#2*2}, {-0.6-#1*2});
}

\newcommand\ndn[2]
{
\draw [blue, -{Latex[length=\len, width=\wdth]}, line width=\lwdth]
({#2*2}, {0.6-#1*2}) -- ({#2*2}, {-0.6-#1*2});
}

\newcommand\nupdn[2]
{
\draw [red, {Latex[length=\len, width=\wdth]}-, line width=\lwdth]
({#2*2-\spinsep}, {0.6-#1*2}) -- ({#2*2-\spinsep}, {-0.6-#1*2});
\draw [blue, -{Latex[length=\len, width=\wdth]}, line width=\lwdth]
({#2*2+\spinsep},{0.6-#1*2}) -- ({#2*2+\spinsep},{-0.6-#1*2});
\node at ({#2*2+0.5},{-#1*2+0.5}) {$U$};
}

\newcommand\hoppingdown[2]{
    \draw [->, thick]
    ({#2*2-0.4}, {-0.4-#1*2}) to [bend right=30] node[midway, left] {$t$} ({#2*2-0.4}, {-1.6-#1*2});
}

\newcommand\hoppingright[2]{
    \draw [->, thick]
    ({#2*2+0.4}, {0.4-#1*2}) to [bend left=30] node[midway, above] {$t$} ({#2*2+1.6}, {0.4-#1*2});
}

\begin{tikzpicture}
    [
        node distance=10mm,
        inner sep=1mm,
        minimum size=5mm,
        site/.style={rectangle,draw=black,very thick,fill=gray!20},
    ]
    % grid
    \draw [dashed] (1,-1) grid[step=20mm] (2*\nsites+1,-2*\nsites-1);
    % sites
    \foreach \x in {1,...,\nsites}
        {
            \foreach \y in {1,...,\nsites}
                {
                    % \node [site, label=\x\y] at (2*\x,-2*\y) (s\x\y) {};
                    \node [site] at (2*\x,-2*\y) (s\x\y) {};
                }
        }
    % add electrons
    \nup{1}{1}
    \ndn{1}{2}
    \nupdn{1}{3}
    \ndn{2}{3}
    \nup{3}{1}
    \nupdn{3}{2}
    \hoppingdown{1}{1}
    \hoppingright{1}{1}
\end{tikzpicture}
