%! TeX root = ../main.tex

\chapter{Methods}%
\label{ch:methods}

\subsection{Natural impurity orbitals}%
\label{sec:natural-impurity-orbitals}

To solve the Anderson impurity model,
we can use Slater determinants to decompose the wave function
\begin{equation}
    \ket{\psi} = \sum_{i=1}^M \alpha_i \ket{\alpha_i}
    \label{eq:slater-decomposition}
\end{equation}
using any orthonormal set of basis functions.
With the occupation number,
we can express the number of electrons in each spin sector as
the sum of impurity and bath electrons
\begin{equation}
    N_\sigma = n_{i,\sigma} + \sum_{k=1}^N n_{b,k\sigma}.
\end{equation}
For a fixed amount of electrons $N_\mathrm{tot} = N_\uparrow + N_\downarrow$,
a combination of
\begin{equation}
    M = \binom{N+1}{n_\uparrow} \cdot \binom{N+1}{n_\downarrow}
\end{equation}
determinants are necessary to fully describe the wave function.
For a half-filled system ($N_\uparrow = N_\downarrow = (N+1)/2$)
with $N+1=140$ sites, this is approximately $\num{9e81}$
exceeding the number of protons in the observable universe $\bigO{\num{e80}}$. % Eddington number
As this is not treatable numerically,
we need to truncate a certain number of determinants with the smallest probabilities.
To save computational resources,
we want to find a new basis in which the probabilities
$|\alpha_i^2|$ in \zcref{eq:slater-decomposition}
decay faster than those of the star geometry
(further details in~\cite{Bi2019}).

Given a spin-orbital basis set $\{\ket{\phi_{i\sigma}}\}$
with their respective creator $c_{i\sigma}^\dag$~\cite{Bi2019},
the density matrix of the ground state is defined as
\begin{equation}
    n_{ij\sigma} = \sandwich{\psi_0}{c_{i\sigma}^\dag c_{j\sigma}}{\psi_0}.
\end{equation}
A commonly employed basis in quantum chemistry are the \emph{natural orbitals},
where the orbitals $\ket{\phi_{i\sigma}}$ are chosen such that
the aforementioned density matrix is diagonal $n_{ij\sigma} = \delta_{ij}n_{ij\sigma}$.
However,
a naive implementation of the natural orbitals will inevitably mix the original impurity
and bath sites transforming the local Coulomb interaction (\zcref{eq:Anderson-interaction})
among multiple new sites,
losing locality~\cite{Lu2014,Lu2019}.
We therefore use the \emph{natural impurity orbitals}
which only rotates bath orbitals while keeping the impurity untouched.
This new geometry is shown in \zcref{subfig:geometry-natural-impurity-orbitals}.
The unchanged impurity $i$ is connected to a mirror site (labeled $m$) and two chains.
Following the convention of~\cite{Lu2014,Lu2019},
we call sites in the almost fully filled chain valence bath sites (labeled $v$),
and sites in the almost empty chain as conduction bath sites (labeled $c$).
Hopping between sites is again shown by lines.

\section{Restricted active space}%
\label{sec:ras}

\fe{NOTE:\@ I think RAS fits better than CI.}

Using the natural impurity orbitals (\zcref{sec:natural-impurity-orbitals}) allows us to
write the ground state in a basis which has optimal scaling behavior with respect to
the number of bath sites~\cite{Lu2019}.
However, the computational complexity still grows combinatorial with each added bath site.
To alleviate the scaling problem we employ the same restricted active space (RAS) method
as \citeauthor{Lu2019}~\cite{Lu2019}, which is sketched in \zcref{fig:aim-separation}.

\begin{figure}[ht]
    \centering
    \input{graphics/tikz/aim_separation.tex}
    \caption{
        Separation of the wave function into two components
        $\ket{\phi_I}$ and $\ket{\phi_{II}}$ denoted by two boxes.
    }%
    \label{fig:aim-separation}
\end{figure}

The full Hilbert space is projected onto a subspace that only contains
empty conduction sites $\ket{\mathbb{0}_c}$
and full valence sites $\ket{\mathbb{1}_v}$ for $l>L$.
The ground state can be written as
\begin{equation}
    \ket{\psi_0}
    =
    \ket{\phi_I} \otimes \ket{\mathbb{0}_c} \otimes \ket{\mathbb{1}_v}
    =
    \ket{\phi_I} \otimes \ket{\phi_{II}},
\end{equation}
where $\ket{\phi_I}$ is the exact ground state calculated by ED for some $L$
and $\ket{\phi_{II}} = \ket{\mathbb{0}_c} \otimes \ket{\mathbb{1}_v}$ is a reference state.

In the next step we loosen the restriction of empty conduction and full valence bath sites
in $\ket{\phi_{II}}$.
The $p=1$ projection allows one state to differ from the reference state:
Either one electron of $\ket{\phi_I}$ enters the empty conduction sites
or one electron from the full valence sites enters $\ket{\phi_I}$.
In the $p=2$ projection two states are allowed to differ.
This allows for one of the following possibilities for $\ket{\phi_{II}}$:
Two electrons in the conduction bath sites $c_l$,
two holes in the valence bath sites $v_l$,
or one electron in the conduction bath sites $c_l$
and one hole in the valence bath sites $v_l$ ($l\ge L$).

\section{Lanczos algorithm}%
\label{sec:lanczos-algorithm}

The Lanczos algorithm~\cite{Lanczos1950} can be used to approximate the extremal eigenvalues
of a hermitian $n\times n$ matrix.
In our case we are interested in the ground state and low energy excitations of a
given Hamiltonian $H$ (\zcref{eq:H-Anderson}).
The method is especially useful if $H$ is sparse and too large to decompose fully.
It is based on a Krylov basis
\begin{equation}
    \mathcal{K}^M(H, \vec{q}) = \spn\{\vec{q}, H\vec{q}, H^2\vec{q}, \ldots, H^{M-1}\vec{q}\}
\end{equation}
for a given vector $\vec{q}$.
Typically, the value $M$ is very small compared to the matrix size: $M \ll n$.
Instead of a simple power iteration, the Lanczos algorithm is described by the
following recurrence relation
\begin{equation}
    b_j\vec{q}_{j+1} = H\vec{q}_j - a_j\vec{q}_j - b_{j-1}\vec{q}_{j-1}
    \label{eq:Lanczos-recurrence}
\end{equation}
with a normalized starting vector $\vec{q}_1$ and $\vec{q}_0 = \vec{0}$.
The coefficients are chosen such that each Lanczos vector $\vec{q}_j$ is orthonormal to each other
\begin{equation}
    a_j = \vec{q}_j^\dag H \vec{q}_j,
    \qquad
    b_j = \vec{q}_{j+1}^\dag H \vec{q}_j.
\end{equation}
For numerical stability~\cite{Paige1972, Paige1976}
we instead calculate the coefficients as
\begin{equation}
    a_j = \vec{q}_j^\dag(H \vec{q}_j - \beta_{j-1}\vec{q}_{j-1}),
    \qquad
    b_j = \norm{H\vec{q}_j - \alpha\vec{q}_j -  \beta_{j-1}\vec{q}_{j-1}}.
\end{equation}
From this relation we can create the tridiagonal matrix
\begin{equation}
    T
    =
    \begin{pmatrix}
        a_1 & b_1 &        &         &         \\
        b_1 & a_2 & b_2    &         &         \\
            & b_2 & a_3    & \ddots  &         \\
            &     & \ddots & \ddots  & b_{M-1} \\
            &     &        & b_{M-1} & a_M
    \end{pmatrix}
    \label{eq:tridiagonal-scalar}
\end{equation}
and matrix collecting all Lanczos vectors
\begin{equation}
    Q = (\vec{q}_1, \vec{q}_2, \ldots, \vec{q}_M).
\end{equation}
Rewriting \zcref{eq:Lanczos-recurrence} in matrix form and rearranging results in $T = Q^\dag H Q$,
which means that $T$ is the orthogonal projection of $H$ onto
the subspace $\mathcal{K}^M(H, \vec{q}_1)$~\cite{Cullum1985}.

\subsection{Block Lanczos}

Instead of calculating only one vector $\vec{q}_j$ in each step,
one can calculate $p$ vectors simultaneously.
We define
\begin{equation}
    Q_1 = (\vec{q}_1^{(1)}, \vec{q}_1^{(2)}, \ldots, \vec{q}_1^{(p)})
\end{equation}
to be an $n\times p$ orthonormal block of starting vectors
and $Q_0 = \mathbb{0}_{n\times q}$.
Then the recurrence relation (\zcref{eq:Lanczos-recurrence}) can be rewritten as
\begin{equation}
    Q_{j+1} B_j = H Q_j - Q_j A_j - Q_{j-1} B_{j-1}^\dag,
    \label{eq:block-Lanczos-recurrence}
\end{equation}
with $A_j$, $B_j$ matrices of size $p\times p$ chosen such that each block $Q_j$ is orthonormal
to each other.
The block tridiagonal matrix of size $Mp\times Mp$ is written as
\begin{equation}
    T
    =
    \begin{pmatrix}
        A_1 & B_1^\dag &          &         &              \\
        B_1 & A_2      & B_2^\dag &         &              \\
            & B_2      & A_3      & \ddots  &              \\
            &          & \ddots   & \ddots  & B_{M-1}^\dag \\
            &          &          & B_{M-1} & A_M
    \end{pmatrix}.
    \label{eq:tridiagonal-block}
\end{equation}
For the calculation for $B_j$ one needs to orthonormalize
\begin{equation}
    \tilde Q_{j+1} = H Q_j - Q_j A_j - Q_{j-1} B_{j-1}^\dag,
\end{equation}
which is not unique.
For instance, a QR decomposition $Q_{j+1} B_j = \tilde Q_{j+1}$
results in an upper triangular matrix $B_j$
which gives $T$ a compactly banded structure~\cite{Cullum1985, Golub2013}.
In our work however, we use symmetric LÃ¶wdin orthonormalization~\cite{Lowdin1950, Brass2021}
which is based on the singular value decomposition
$\tilde Q_{j+1} = U \Sigma V^\dag$.
We define the overlap matrix as
\begin{equation}
    S \coloneqq \tilde Q_{j+1}^\dag \tilde Q_{j+1} = V \Sigma^2 V^\dag
\end{equation}
and its roots as
\begin{equation}
    S^{1/2} = V \Sigma V^\dag,
    \qquad
    S^{-1/2} = V \Sigma^{-1} V^\dag.
\end{equation}
The resulting vectors are then
\begin{align}
    Q_{j+1} & = \tilde Q_{j+1} S^{-1/2} \qquad \text{and} \\
    B_j     & = S^{1/2}.
\end{align}
We use this method as it guarantees hermiticity in the off-diagonal blocks $B_j^\dag = B_j$
albeit losing the compactly banded structure for $T$.
If $\tilde Q_j$ is rank-deficient,
this method can still be applied~\cite{Brass2021} by only inverting the block of
non-vanishing singular values
\begin{equation}
    \Sigma =
    \begin{pmatrix}
        \Sigma_i \neq 0 & 0 \\
        0               & 0
    \end{pmatrix}
    \qquad
    \Sigma^{-1} =
    \begin{pmatrix}
        \Sigma_i^{-1} & 0 \\
        0             & 0
    \end{pmatrix},
\end{equation}
still guaranteeing orthogonality against previous states $Q_i^\dag Q_j = \mathbb{0}_{q\times q}$
for $i \in \{1,\ldots,j-1\}$~\cite{Golub2013}.

