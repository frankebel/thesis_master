%! TeX root = ../../main.tex

\chapter{Model and methods}

\section{Anderson impurity model}

% TODO: reference DMFT
In DMFT (more in section TODO) a Hubbard model is mapped onto an Anderson impurity model (AIM)
which then needs to be solved.
In this work we will only look at the single impurity Anderson model (SIAM).
Its Hamiltonian can be split into an interacting and non-interacting part
$H = H_0 + H_\mathrm{int}$.
Denoting the impurity annihilators by $d_\sigma$ ($n_\sigma = d^\dag_\sigma d^{\pdag}_\sigma$)
and bath annihilators by $c_\sigma$
it can be written as
\begin{align}
    H_0
     & =
    \sum_{\pk\sigma} (\epsilon_{d,\sigma} - \mu) d^\dag_{\pk\sigma} d^{\pdag}_{\pk\sigma}
    +
    \sum_{k\sigma} \epsilon_{k\sigma}^{\pdag} c^\dag_{k\sigma} c^{\pdag}_{k\sigma}
    +
    \sum_{k\sigma} \left(V^{\ps}_{k\sigma} d^\dag_{\vphantom{k}\sigma} c^{\pdag}_{k\sigma}
    + V_{k\sigma}^* c^\dag_{k\sigma} d^{\pdag}_{\vphantom{k}\sigma} \right),
    \\
    H_\mathrm{int}
     & =
    U n_\uparrow n_\downarrow.
\end{align}
Here,
$\epsilon_{d,\sigma}$ denotes the impurity energy,
$\mu$ the chemical potential,
$\epsilon_{k\sigma}$ the energy levels of the bath,
and $V_{k\sigma}$ the hybridization between the bath and impurity.
A graphical representation is given in \zcref{subfig:geometry-star}.

\begin{figure}[ht]
    \centering
    \savebox{\imagebox}{\input{graphics/tikz/geometry_star.tex}} % save for height alignment
    \begin{subfigure}{0.45\textwidth}
        \centering
        \usebox{\imagebox}
        \caption{star geometry}
        \label{subfig:geometry-star}
    \end{subfigure}
    \begin{subfigure}{0.45\textwidth}
        \centering
        \raisebox{\dimexpr0.5\ht\imagebox-0.5\height}
        {
            \input{graphics/tikz/geometry_natural_impurity_orbitals.tex}
        }
        \caption{natural impurity orbitals}
        \label{subfig:geometry-natural-impurity-orbitals}
    \end{subfigure}
    \caption{
        Anderson impurity model in different geometries.
        Impurity (square) interacting with bath sites (circle).
        Site occupation is indicated by fill level, hopping by lines connecting sites.
        \subref{subfig:geometry-star} is the conventional ``star'' geometry;
        \subref{subfig:geometry-natural-impurity-orbitals} the natural impurity orbitals geometry
        (adapted from~\cite{Lu2019}).
    }
\end{figure}

\section{Correlators}

The retarded correlator for two fermionic operators $A, B$ is defined as
\begin{align}
    C(t) = -\mi \Theta(t) \langle\{A(t), B\}\rangle,
\end{align}
with the step function $\Theta$ and anticommutator $\{\cdot,\cdot\}$.
$A(t) = \me^{\mi H t} A \me^{-\mi H t}$ is given in the Heisenberg picture.
At zero temperature $T=0$, the expectation value is evaluated on the ground state
$\langle\cdot\rangle = \langle\psi_0 | \cdot | \psi_0\rangle$ only.
In the following we will use the notation established by \cite{Bulla1998}.
The correlator can be Fourier transformed to
a complex frequency $z$
\begin{equation}
    C_z = \int_{-\infty}^\infty\! \md t\> \me^{\mi zt} C(t) \eqqcolon \lAngle A, B \rAngle_z.
\end{equation}
Furthermore, this expression can be split into two components $C_z = C^+_z + C^-_z$ with
\begin{subequations}
    \begin{align}
        C^+_z
         & =
        \left\langle A \frac{1}{z - H + E_0} B\right\rangle
        =
        \sum_n \frac{\langle\psi_0 | A | n\rangle\langle n | B | \psi_0\rangle}{z - E_n + E_0}, \\
        C^-_z
         & =
        \left\langle B \frac{1}{z + H - E_0} A\right\rangle
        =
        \sum_n \frac{\langle\psi_0 | B | n\rangle\langle n | A | \psi_0\rangle}{z + E_n - E_0}.
    \end{align}
\end{subequations}
The sum is over a complete basis $H|n\rangle = E_n|n\rangle$ with ground state energy $E_0$.
A derivation is given in \zcref{app:fourier-transform}.
The problem however is the exponential algorithmic complexity:
For $N$ sites (bath and impurity), the number of all possible states scales as $O(4^N)$
limiting exact diagonalization (ED) to $N=O(10)$ sites.

\subsection{Green's function}

For the choice $A=d_\sigma, B=d_\sigma^\dag$ the correlator describes
the propagation of an electron/hole in the system and is called Green's function
\begin{subequations}
    \begin{align}
        G^+_{\sigma z}
         & =
        \left\langle d_\sigma \frac{1}{z - H + E_0} d_\sigma^\dag\right\rangle
        =
        \sum_n \frac{|\langle n | d_\sigma^\dag | \psi_0\rangle|^2}{z - E_n + E_0},
        \label{eq:Greens-function-plus} \\
        G^-_{\sigma z}
         & =
        \left\langle d_\sigma^\dag \frac{1}{z + H - E_0} d_\sigma\right\rangle
        =
        \sum_n \frac{|\langle n | d_\sigma | \psi_0\rangle|^2}{z + E_n - E_0}.
        \label{eq:Greens-function-minus}
    \end{align}
\end{subequations}

\subsection{Spectral function}

Given a Green's function $G_{\sigma z}$ the corresponding spectral function is defined as
\begin{equation}
    A_{\sigma z} = -\frac{1}{\muppi}\Im G_{\sigma z},
\end{equation}
giving
\begin{subequations}
    \begin{align}
        A^+_{\sigma z}
         & =
        \sum_n |\langle n | d_\sigma^\dag | \psi_0\rangle|^2 \frac{1}{\muppi} \frac{\delta}{(\omega - E_n + E_0)^2 + \delta^2} \\
        A^-_{\sigma z}
         & =
        \sum_n |\langle n | d_\sigma | \psi_0\rangle|^2 \frac{1}{\muppi} \frac{\delta}{(\omega + E_n - E_0)^2 + \delta^2}
    \end{align}
\end{subequations}
which can be interpreted as a sum of Lorentzians with broadening parameter $\delta$
and weights $|\langle n | d_\sigma^{(\dag)} | \psi_0\rangle|^2$.
Going to the real axis $\delta\rightarrow0^+$ will then give us discrete delta-peaks
\begin{subequations}
    \begin{align}
        A^+_{\sigma\omega}
         & =
        \sum_n |\langle n | d_\sigma^\dag | \psi_0\rangle|^2 \delta(\omega - E_n + E_0) \\
        A^-_{\sigma\omega}
         & =
        \sum_n |\langle n | d_\sigma | \psi_0\rangle|^2 \delta(\omega + E_n - E_0).
    \end{align}
\end{subequations}
For the total weight we can show that the spectrum is normalized
\begin{align}
    \int_{-\infty}^\infty\! \md\omega A_{\sigma z}
     & =
    \sum_n |\langle n | d_\sigma^\dag | \psi_0\rangle|^2
    + \sum_n |\langle n | d_\sigma | \psi_0\rangle|^2                                              \\
     & =
    \sum_n \langle \psi_0 | d_\sigma^{\pdag} | n\rangle\langle n | d_\sigma^\dag | \psi_0\rangle
    + \sum_n \langle \psi_0 | d_\sigma^\dag | n\rangle\langle n | d_\sigma^{\pdag} | \psi_0\rangle \\
     & =
    \langle d_\sigma^{\pdag} d_\sigma^\dag\rangle + \langle d_\sigma^\dag d_\sigma^{\pdag}\rangle  \\
     & =
    \langle \{d_\sigma^{\pdag}, d_\sigma^\dag\}\rangle                                             \\
     & =
    \langle \mathbb{1}\rangle                                                                      \\
     & =
    1.
\end{align}


\subsection{Kramers-Kronig relations}

The real and imaginary part of a correlator are not independent
but related by Kramers-Kronig transformations (Hilbert transform)
\begin{subequations}
    \begin{align}
        \Re C_\omega
         & =
        - \frac{1}{\muppi} \mathcal{P}\! \int_{-\infty}^\infty\! \md\omega'
        \frac{\Im C_{\omega'}}{\omega - \omega'} \\
        \Im C_\omega
         & =
        \phantom{-} \frac{1}{\muppi} \mathcal{P}\! \int_{-\infty}^\infty\! \md\omega'
        \frac{\Re C_{\omega'}}{\omega - \omega'}.
        \label{eq:Kramers-Kronig-relation}
    \end{align}
\end{subequations}

By analogy we can generalize the ``spectral part'' of any correlator as
\begin{equation}
    \tilde A_z = -\frac{1}{\muppi}\Im C_z.
\end{equation}
If we use Gaussian broadening ($\Im C_\omega \propto \me^{-\omega^2}$) instead of
Lorentzians ($\Im C_\omega \propto (\omega^2 + \delta^2)^{-1}$)
for the spectral part,
the real part can be obtained through the Dawson function
\begin{equation}
    D(\omega)
    \coloneqq
    \me^{-\omega^2}\int_0^\omega\! \md a\> \me^{a^2},
\end{equation}
where after applying the Kramers-Kronig relation
from \zcref{eq:Kramers-Kronig-relation} yields
\begin{equation}
    \frac{2}{\sqrt{\muppi}}D(\omega)
    =
    \frac{1}{\muppi} \mathcal{P} \int_{-\infty}^\infty\! \md\omega'
    \frac{\me^{-\omega'^2}}{\omega - \omega'}.
\end{equation}
This allows us to obtain the real part without evaluating the integral explicitly.


\section{Lanczos algorithm}

The Lanczos algorithm \cite{Lanczos1950} can be used to approximate the extremal eigenvalues
(in our case the ground state and states close to it)
of a hermitian $n\times n$ matrix $A$.
It is especially useful if $A$ is sparse and too large to decompose fully.
It is based on a Krylov basis
\begin{equation}
    \mathcal{K}_m(A, \vec{v}) = \spn\{\vec{v}, A\vec{v}, A^2\vec{v}, \ldots, A^{m-1}\vec{v}\}
\end{equation}
for a given vector $\vec{v}$.
Typically, the value $m$ is very small compared to the matrix size: $m \ll n$.
Instead of a simple power iteration, the Lanczos algorithm is described by the
following recurrence relation
\begin{equation}
    \beta_j\vec{v}_{j+1} = A\vec{v}_j - \alpha_j\vec{v}_j - \beta_{j-1}\vec{v}_{j-1}
    \label{eq:Lanczos-recurrence}
\end{equation}
with a normalized starting vector $\vec{v}_1$ and $\beta_0 = 0$.
The coefficients are chosen such that each Lanczos vector $\vec{v}_j$ is orthonormal to each other
\begin{equation}
    \alpha_j = \vec{v}_j^\dag A \vec{v}_j,
    \qquad
    \beta_j = \vec{v}_{j+1}^\dag A\vec{v}_j.
\end{equation}
For numerical stability \cite{Paige1972, Paige1976}
we instead calculate the coefficients as
\begin{equation}
    \alpha_j = \vec{v}_j^\dag( A \vec{v}_j - \beta_{j-1}\vec{v}_{j-1}),
    \qquad
    \beta_j = \Vert A\vec{v}_j - \alpha\vec{v}_j -  \beta_{j-1}\vec{v}_{j-1} \Vert.
\end{equation}
From this relation we can create the tridiagonal matrix
\begin{equation}
    T
    =
    \begin{pmatrix}
        \alpha_1 & \beta_1  &          &             &             \\
        \beta_1  & \alpha_2 & \beta_2  &             &             \\
                 & \beta_2  & \alpha_3 & \ddots      &             \\
                 &          & \ddots   & \ddots      & \beta_{m-1} \\
                 &          &          & \beta_{m-1} & \alpha_m
    \end{pmatrix}
\end{equation}
and matrix which collects all Lanczos vectors
\begin{equation}
    V = (\vec{v}_1, \vec{v}_2, \ldots, \vec{v}_m).
\end{equation}
Then, \zcref{eq:Lanczos-recurrence} in matrix form can be rewritten as
\begin{equation}
    A V = V T + \beta_{m}\vec{v}_{m+1}\vec{e}_{m}^\intercal,
\end{equation}
where $\vec{e}_m$ is the Euclidean basis vector with $m$-th component 1 and all other 0.
Rearraning gives
\begin{equation}
    T = V^\dag A V,
\end{equation}
which means that $T$ is the orthogonal projection of $A$ onto
the subspace $\mathcal{K}_m(A, \vec{v}_1)$ \cite{Cullum1985}.
Diagonalization gives us then an approximation for our original matrix
\begin{equation}
    A \approx V T V^\dag = V U \Lambda U^\dag V^\dag.
    \label{eq:Lanczos-matrix-approximation}
\end{equation}

For our Green's function we define the vector $\tilde{\vec{v}}_1 = d_\sigma^\dag \vec{\psi}_0$
and its norm $s = ||\tilde{\vec{v}}_1||$.
Using $\vec{v}_1 = \tilde{\vec{v}}_1/s$ as our initial Lanczos vector,
\zcref{eq:Greens-function-plus} can be reformulated as
\begin{equation}
    G^+_{\sigma z} = s \vec{v}_1^\dag \frac{1}{z - H + E_0} \vec{v}_1 s.
\end{equation}
If we denote our eigenvalues as $E_i$ and $U_1$ as the first row of $U$,
applying \zcref{eq:Lanczos-matrix-approximation} simplifies to
\begin{align}
    \begin{split}
        G^+_{\sigma z}
         & =
        s \vec{v}_1^\dag V U \frac{1}{z - E + E_0} U^\dag V^\dag \vec{v}_1 s \\
         & =
        \sum_{i=1}^m \frac{|s U_{1,i}|^2}{z - E_i + E_0}.
    \end{split}
\end{align}
Analogously, for $G^-_{\sigma z}$ we can start with $\tilde{\vec{v}}_1 = d_\sigma \vec{\psi}_0$.
Adding both components and simplifying gives us a sum of discrete delta-functions \cite{Lu2014}
\begin{equation}
    G_{\sigma\omega} = \sum_i \frac{|b_i|^2}{\omega + \mi 0^+ - \epsilon_i}.
\end{equation}

\subsection{Block Lanczos}

Instead of calculating only one vector $\vec{v}_j$ in each step,
one can calculate $q$ vectors simultaneously.
We define
\begin{equation}
    Q_1 = (\vec{q}_1^{(1)}, \vec{q}_1^{(2)}, \ldots, \vec{q}_1^{(q)})
\end{equation}
to be an
$n\times q$ orthonormal block of starting vectors
and a zero matrix $B_0 = \mathbb{0}_{q\times q}$.
Then the recurrence relation (\zcref{eq:Lanczos-recurrence}) can be rewritten as
\begin{equation}
    Q_{j+1} B_j = A Q_j - Q_j A_j - Q_{j-1} B_{j-1}^\dag,
    \label{eq:block-Lanczos-recurrence}
\end{equation}
from which we can construct a block tridiagonal matrix
\begin{equation}
    T
    =
    \begin{pmatrix}
        A_1 & B_1^\dag &          &         &              \\
        B_1 & A_2      & B_2^\dag &         &              \\
            & B_2      & A_3      & \ddots  &              \\
            &          & \ddots   & \ddots  & B_{m-1}^\dag \\
            &          &          & B_{m-1} & A_m
    \end{pmatrix}
\end{equation}
of size $mq\times mq$.
The matrices $A_j, B_j$ are again chosen such that each block of Lanczos vectors is orthonormal
$Q_i^\dag Q_j = \delta_{ij}\mathbb{1}_{q\times q}$ to each other.
For the calculation for $B_j$ one needs to orthornormalize
\begin{equation}
    \tilde Q_{j+1} = A Q_j - Q_j A_j - Q_{j-1} B_{j-1}^\dag
\end{equation}
which is not unique.
For instance, a QR decomposition \cite{Cullum1985, Grimes1994} $Q B = \tilde{Q}$
results in an upper triangular matrix $B$ which gives $T$ a compactly banded structure.
In our work however, we use symmetric Löwdin orthonormalization \cite{Lowdin1950, Brass2021}
which is based on the singular value decomposition $\tilde Q = U \Sigma V^\dag$.
We define the overlap matrix as
\begin{equation}
    S \coloneqq \tilde Q^\dag \tilde Q = V \Sigma^{2} V^\dagger
\end{equation}
and its roots as
\begin{equation}
    S^{1/2}  = V \Sigma V^\dagger, \qquad S^{-1/2} = V \Sigma^{-1} V^\dagger.
\end{equation}
The resulting vectors are then
\begin{align}
    Q & = \tilde Q S^{-1/2}, \\
    B & = S^{1/2}.
\end{align}
We use this method as it guarantees hermiticity in the off-diagonal blocks $B^\dag = B$
albeit losing the compactly banded structure for $T$.
In practice, we calculate the overlap matrix and decompose it as $S = V \Lambda V^\dag$
where $\Lambda$ are the squared singular values.

\section{Natural impurity orbitals}

natural impurity orbitals
Hybridization function
\begin{align}
    \Delta(z) = \sum_{k\sigma} \frac{|V_{k\sigma}|^2}{z - \epsilon_{k\sigma}}
\end{align}

\section{Self-energy}

\begin{itemize}
    \item Dyson equation, $\Sigma^\mathrm{D}$
    \item $\Sigma^\mathrm{FG}$
    \item $\Sigma^\mathrm{IFG}$
\end{itemize}

\section{DMFT}

\begin{itemize}
    \item Bethe lattice
\end{itemize}

\section{Configuration interaction}
