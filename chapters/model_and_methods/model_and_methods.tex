%! TeX root = ../../main.tex

\chapter{Model and methods}

\section{Hubbard model}

\begin{equation}
    H
    =
    -t\sum_{\langle i j\rangle\sigma}
    (c^\dag_{i\sigma} c^{\pdag}_{j\sigma} + c^\dag_{j\sigma} c^{\pdag}_{i\sigma})
    +
    U\sum_{i\sigma} n_{i\uparrow} n_{i\downarrow}
    -
    \mu\sum_{i\sigma} n_{i\sigma}
\end{equation}

\section{Anderson impurity model}

% TODO: reference DMFT
In DMFT (more in section TODO) a Hubbard model is mapped onto an Anderson impurity model (AIM)
which then needs to be solved.
In this work we will only look at the single impurity Anderson model (SIAM).
Its Hamiltonian can be split into an interacting and non-interacting part
$H = H_0 + H_\mathrm{int}$.
Denoting the impurity annihilators by $d_\sigma$ ($n_\sigma = d^\dag_\sigma d^{\pdag}_\sigma$)
and bath annihilators by $c_\sigma$
it can be written as
\begin{align}
    H_0
     & =
    \sum_{\pk\sigma} (\epsilon_{d,\sigma} - \mu) d^\dag_{\pk\sigma} d^{\pdag}_{\pk\sigma}
    +
    \sum_{k\sigma} \epsilon_{k\sigma}^{\pdag} c^\dag_{k\sigma} c^{\pdag}_{k\sigma}
    +
    \sum_{k\sigma} \left(V^{\ps}_{k\sigma} d^\dag_{\vphantom{k}\sigma} c^{\pdag}_{k\sigma}
    + V_{k\sigma}^* c^\dag_{k\sigma} d^{\pdag}_{\vphantom{k}\sigma} \right),
    \\
    H_\mathrm{int}
     & =
    U n_\uparrow n_\downarrow.
\end{align}
Here,
$\epsilon_{d,\sigma}$ denotes the impurity energy,
$\mu$ the chemical potential,
$\epsilon_{k\sigma}$ the energy levels of the bath,
and $V_{k\sigma}$ the hybridization between the bath and impurity.
A graphical representation is given in \zcref{subfig:geometry-star}.

\begin{figure}[ht]
    \centering
    \savebox{\imagebox}{\input{graphics/tikz/geometry_star.tex}} % save for height alignment
    \begin{subfigure}{0.45\textwidth}
        \centering
        \usebox{\imagebox}
        \caption{star geometry}
        \label{subfig:geometry-star}
    \end{subfigure}
    \begin{subfigure}{0.45\textwidth}
        \centering
        \raisebox{\dimexpr0.5\ht\imagebox-0.5\height}
        {
            \input{graphics/tikz/geometry_natural_impurity_orbitals.tex}
        }
        \caption{natural impurity orbitals}
        \label{subfig:geometry-natural-impurity-orbitals}
    \end{subfigure}
    \caption{
        Anderson impurity model in different geometries.
        Impurity (square) interacting with bath sites (circle).
        Site occupation is indicated by fill level, hopping by lines connecting sites.
        \subref{subfig:geometry-star} is the conventional ``star'' geometry;
        \subref{subfig:geometry-natural-impurity-orbitals} the natural impurity orbitals geometry
        (adapted from~\cite{Lu2019}).
    }
\end{figure}

\section{Correlators}

The retarded correlator for two fermionic operators $A, B$ is defined as
\begin{align}
    C(t) = -\mi \Theta(t) \langle\{A(t), B\}\rangle,
\end{align}
with the step function $\Theta$ and anticommutator $\{\cdot,\cdot\}$.
$A(t) = \me^{\mi H t} A \me^{-\mi H t}$ is given in the Heisenberg picture.
At zero temperature $T=0$, the expectation value is evaluated on the ground state
$\langle\cdot\rangle = \langle\psi_0 | \cdot | \psi_0\rangle$ only.
We will denote the Fourier transform as $C_\omega$ which is defined as
\begin{equation}
    C_\omega
    =
    \lim_{\delta\to 0^+}
    \int_{-\infty}^\infty\! \md t\> \me^{\mi (\omega + \mi\delta) t} C(t).
\end{equation}
Furthermore,
we split this expression into two components $C_\omega = C^+_\omega + C^-_\omega$ with
\begin{subequations}
    \begin{align}
        C^+_\omega
         & =
        \left\langle A \frac{1}{\omega - H + E_0} B\right\rangle
        =
        \sum_n \frac{\langle\psi_0 | A | n\rangle\langle n | B | \psi_0\rangle}{\omega - E_n + E_0}, \\
        C^-_\omega
         & =
        \left\langle B \frac{1}{\omega + H - E_0} A\right\rangle
        =
        \sum_n \frac{\langle\psi_0 | B | n\rangle\langle n | A | \psi_0\rangle}{\omega + E_n - E_0}.
    \end{align}
\end{subequations}
The sum is over a complete basis $H|n\rangle = E_n|n\rangle$ with ground state energy $E_0$.
A derivation is given in \zcref{app:fourier-transform}.
The problem however is the exponential algorithmic complexity:
For $N$ sites (bath and impurity), the number of all possible states scales as $O(4^N)$
limiting exact diagonalization (ED) to $N=O(10)$ sites.

For the choice $A=d_\sigma, B=d_\sigma^\dag$ the correlator describes
the propagation of an electron/hole in the system and is called Green's function
\begin{subequations}
    \begin{align}
        G^+_\omega
         & =
        \left\langle d_\sigma \frac{1}{\omega - H + E_0} d_\sigma^\dag\right\rangle,
        \label{eq:Greens-function-plus} \\
        G^-_\omega
         & =
        \left\langle d_\sigma^\dag \frac{1}{\omega + H - E_0} d_\sigma\right\rangle.
        \label{eq:Greens-function-minus}
    \end{align}
\end{subequations}

\subsection{Spectral part}

Given a correlator $C_\omega$ the corresponding spectral part is defined as
\begin{equation}
    A_\omega = -\frac{1}{\muppi}\Im C_\omega,
\end{equation}
giving
\begin{subequations}
    \begin{align}
        A^+_\omega
         & =
        \sum_n \langle\psi_0 | A | n\rangle\langle n | B | \psi_0\rangle \delta(\omega - E_n + E_0),
        \label{eq:spectral-part-plus} \\
        A^-_\omega
         & =
        \sum_n \langle\psi_0 | B | n\rangle\langle n | A | \psi_0\rangle \delta(\omega + E_n - E_0).
        \label{eq:spectral-part-minus}
    \end{align}
\end{subequations}
For our Green's function we call it the spectral function
\begin{subequations}
    \begin{align}
        A^+_\omega
         & =
        \sum_n |\langle n | d_\sigma^\dag | \psi_0\rangle|^2 \delta(\omega - E_n + E_0), \\
        A^-_\omega
         & =
        \sum_n |\langle n | d_\sigma | \psi_0\rangle|^2 \delta(\omega + E_n - E_0),
    \end{align}
\end{subequations}
with $A^+_\omega$ measurable in inverse photoemission spectroscopy (IPES)
and $A^-_\omega$ in photoemission spectroscopy (PES) respectively.
The total weight of the spectral function is normalized
as shown in \zcref{app:spectral-function-integration}.


\subsection{Kramers-Kronig relations}

The real and imaginary part of a correlator are not independent
but related by Kramers-Kronig transformations (Hilbert transform)
\begin{subequations}
    \begin{align}
        \Re C_\omega
         & =
        - \frac{1}{\muppi} \mathcal{P}\! \int_{-\infty}^\infty\! \md\omega'
        \frac{\Im C_{\omega'}}{\omega - \omega'}
        \label{eq:kramers-kroneg-real} \\
        \Im C_\omega
         & =
        \phantom{-} \frac{1}{\muppi} \mathcal{P}\! \int_{-\infty}^\infty\! \md\omega'
        \frac{\Re C_{\omega'}}{\omega - \omega'}.
        \label{eq:kramers-kronig-imag}
    \end{align}
\end{subequations}

Thus, we can broaden our delta-peaks from \zcref{eq:spectral-part-plus, eq:spectral-part-minus}
for the imaginary part and obtain the real part through \zcref{eq:kramers-kroneg-real}.
We will denote the broadened correlator as $C_z$
to contrast it against $C_\omega$ which has no broadening.
In this work we will use the following schemes:
\begin{itemize}
    \item Lorentzian broadening characterized by $\delta$:
          \begin{equation}
              \delta(\omega - \omega_0)
              \to
              \frac{1}{\muppi}\frac{\delta}{(\omega - \omega_0)^2 + \delta^2}
          \end{equation}
    \item Gaussian broadening characterized by $\sigma$:
          \begin{equation}
              \delta(\omega - \omega_0)
              \to
              \frac{1}{\sqrt{2\muppi \sigma^2}}\exp\left(-\frac{(\omega - \omega_0)^2}{2\sigma^2}\right)
          \end{equation}
    \item logarithmic Gaussian characterized by $b$ \cite{Bulla2008}:
          \begin{equation}
              \delta(\omega - \omega_0)
              \to
              \Theta(\omega\omega_0)\frac{\me^{-b^2/4}}{b\omega\sqrt{\muppi}}\exp\left(-\frac{(\ln\omega-\ln\omega_0)^2}{b^2}\right).
          \end{equation}
\end{itemize}

\section{Lanczos algorithm}

The Lanczos algorithm \cite{Lanczos1950} can be used to approximate the extremal eigenvalues
of a hermitian $n\times n$ matrix.
In our case we are interested in the ground state and low energy excitations of a
given Hamiltonian $H$.
The method is especially useful if $H$ is sparse and too large to decompose fully.
It is based on a Krylov basis
\begin{equation}
    \mathcal{K}_m(H, \vec{v}) = \spn\{\vec{v}, H\vec{v}, H^2\vec{v}, \ldots, H^{m-1}\vec{v}\}
\end{equation}
for a given vector $\vec{v}$.
Typically, the value $m$ is very small compared to the matrix size: $m \ll n$.
Instead of a simple power iteration, the Lanczos algorithm is described by the
following recurrence relation
\begin{equation}
    \beta_j\vec{v}_{j+1} = H\vec{v}_j - \alpha_j\vec{v}_j - \beta_{j-1}\vec{v}_{j-1}
    \label{eq:Lanczos-recurrence}
\end{equation}
with a normalized starting vector $\vec{v}_1$ and $\beta_0 = 0$.
The coefficients are chosen such that each Lanczos vector $\vec{v}_j$ is orthonormal to each other
\begin{equation}
    \alpha_j = \vec{v}_j^\dag H \vec{v}_j,
    \qquad
    \beta_j = \vec{v}_{j+1}^\dag H \vec{v}_j.
\end{equation}
For numerical stability \cite{Paige1972, Paige1976}
we instead calculate the coefficients as
\begin{equation}
    \alpha_j = \vec{v}_j^\dag(H \vec{v}_j - \beta_{j-1}\vec{v}_{j-1}),
    \qquad
    \beta_j = \Vert H\vec{v}_j - \alpha\vec{v}_j -  \beta_{j-1}\vec{v}_{j-1} \Vert.
\end{equation}
From this relation we can create the tridiagonal matrix
\begin{equation}
    T
    =
    \begin{pmatrix}
        \alpha_1 & \beta_1  &          &             &             \\
        \beta_1  & \alpha_2 & \beta_2  &             &             \\
                 & \beta_2  & \alpha_3 & \ddots      &             \\
                 &          & \ddots   & \ddots      & \beta_{m-1} \\
                 &          &          & \beta_{m-1} & \alpha_m
    \end{pmatrix}
\end{equation}
and matrix which collects all Lanczos vectors
\begin{equation}
    V = (\vec{v}_1, \vec{v}_2, \ldots, \vec{v}_m).
\end{equation}
Then, \zcref{eq:Lanczos-recurrence} in matrix form can be rewritten as
\begin{equation}
    H V = V T + \beta_{m}\vec{v}_{m+1}\vec{e}_{m}^\intercal,
\end{equation}
where $\vec{e}_m$ is the Euclidean basis vector with $m$-th component 1 and all other 0.
Rearraning gives
\begin{equation}
    T = V^\dag H V,
\end{equation}
which means that $T$ is the orthogonal projection of $H$ onto
the subspace $\mathcal{K}_m(H, \vec{v}_1)$ \cite{Cullum1985}.
Diagonalization gives us then an approximation of our original matrix
\begin{equation}
    H \approx V T V^\dag = V U \Lambda U^\dag V^\dag.
    \label{eq:Lanczos-matrix-approximation}
\end{equation}

For our Green's function we define the vector $\tilde{\vec{v}}_1 = d_\sigma^\dag \vec{\psi}_0$
and its norm $s = ||\tilde{\vec{v}}_1||$.
Using $\vec{v}_1 = \tilde{\vec{v}}_1/s$ as our initial Lanczos vector,
\zcref{eq:Greens-function-plus} can be reformulated as
\begin{equation}
    G^+_{\sigma\omega} = s \vec{v}_1^\dag \frac{1}{\omega - H + E_0} \vec{v}_1 s.
\end{equation}
If we denote our eigenvalues as $E_i$ and $U_1$ as the first row of $U$,
applying \zcref{eq:Lanczos-matrix-approximation} simplifies to
\begin{align}
    \begin{split}
        G^+_{\sigma\omega}
         & =
        s \vec{v}_1^\dag V U \frac{1}{\omega - E + E_0} U^\dag V^\dag \vec{v}_1 s \\
         & =
        \sum_{i=1}^m \frac{|s U_{1,i}|^2}{z - E_i + E_0}.
    \end{split}
\end{align}
Analogously, for $G^-_{\sigma\omega}$ we can start with $\tilde{\vec{v}}_1 = d_\sigma \vec{\psi}_0$.
Adding both components and simplifying gives us a sum of discrete delta-functions \cite{Lu2014}
\begin{equation}
    G_{\sigma\omega} = \sum_i \frac{b_i^2}{\omega - a_i}.
\end{equation}

\subsection{Block Lanczos}

Instead of calculating only one vector $\vec{v}_j$ in each step,
one can calculate $q$ vectors simultaneously.
We define
\begin{equation}
    Q_1 = (\vec{q}_1^{(1)}, \vec{q}_1^{(2)}, \ldots, \vec{q}_1^{(q)})
\end{equation}
to be an
$n\times q$ orthonormal block of starting vectors
and a zero matrix $B_0 = \mathbb{0}_{q\times q}$.
Then the recurrence relation (\zcref{eq:Lanczos-recurrence}) can be rewritten as
\begin{equation}
    Q_{j+1} B_j = H Q_j - Q_j A_j - Q_{j-1} B_{j-1}^\dag,
    \label{eq:block-Lanczos-recurrence}
\end{equation}
from which we can construct a block tridiagonal matrix
\begin{equation}
    T
    =
    \begin{pmatrix}
        A_1 & B_1^\dag &          &         &              \\
        B_1 & A_2      & B_2^\dag &         &              \\
            & B_2      & A_3      & \ddots  &              \\
            &          & \ddots   & \ddots  & B_{m-1}^\dag \\
            &          &          & B_{m-1} & A_m
    \end{pmatrix}
\end{equation}
of size $mq\times mq$.
The matrices $A_j, B_j$ are again chosen such that each block of Lanczos vectors is orthonormal
$Q_i^\dag Q_j = \delta_{ij}\mathbb{1}_{q\times q}$ to each other.
For the calculation for $B_j$ one needs to orthornormalize
\begin{equation}
    \tilde Q_{j+1} = H Q_j - Q_j A_j - Q_{j-1} B_{j-1}^\dag
\end{equation}
which is not unique.
For instance, a QR decomposition \cite{Cullum1985, Grimes1994} $Q B = \tilde{Q}$
results in an upper triangular matrix $B$ which gives $T$ a compactly banded structure.
In our work however, we use symmetric Löwdin orthonormalization \cite{Lowdin1950, Brass2021}
which is based on the singular value decomposition $\tilde Q = U \Sigma V^\dag$.
We define the overlap matrix as
\begin{equation}
    S \coloneqq \tilde Q^\dag \tilde Q = V \Sigma^{2} V^\dagger
\end{equation}
and its roots as
\begin{equation}
    S^{1/2}  = V \Sigma V^\dagger, \qquad S^{-1/2} = V \Sigma^{-1} V^\dagger.
\end{equation}
The resulting vectors are then
\begin{align}
    Q & = \tilde Q S^{-1/2}, \\
    B & = S^{1/2}.
\end{align}
We use this method as it guarantees hermiticity in the off-diagonal blocks $B^\dag = B$
albeit losing the compactly banded structure for $T$.
In practice, we calculate the overlap matrix and decompose it as $S = V \Lambda V^\dag$
where $\Lambda$ are the squared singular values.

\section{Natural impurity orbitals}

natural impurity orbitals
Hybridization function
\begin{align}
    \Delta_\omega = \sum_{k\sigma} \frac{|V_{k\sigma}|^2}{\omega - \epsilon_{k\sigma}}
\end{align}

\section{Self-energy}

Dyson equation
\begin{equation}
    \Sigma_\omega = (G_{0, \omega})^{-1} - (G_\omega)^{-1}
\end{equation}
four correlators
\begin{subequations}
    \begin{alignat}{2}
        G_\omega
         & =
        \lAngle d^{\pdag}_\sigma, d_{\sigma}^\dag\rAngle_\omega,
         &
        \qquad
        I_\omega
         & =
        \lAngle q^{\pdag}_\sigma, q_{\sigma}^\dag\rAngle_\omega \\
        F^\mL_\omega
         & =
        \lAngle q^{\pdag}_\sigma, d_{\sigma}^\dag\rAngle_\omega,
         &
        \qquad
        F^\mR_\omega
         & =
        \lAngle d^{\pdag}_\sigma, q_{\sigma}^\dag\rAngle_\omega
    \end{alignat}
\end{subequations}
calculate self-energy as
\begin{equation}
    \Sigma^\mIFG_\omega
    =
    \Sigma^\mH + I_\omega - F^\mL_\omega (G_\omega)^{-1} F^\mR_\omega
\end{equation}
calculate block correlator as

\begin{subequations}
    \begin{align}
        C^+_\omega
         & =
        \biggl\langle \psi_0 \biggr|
        \begin{pmatrix}
            q^{\pdag}_\sigma \\
            d^{\pdag}_\sigma
        \end{pmatrix}
        \frac{1}{\omega - H + E_0}
        \begin{pmatrix}
            q^\dag_\sigma & d^\dag_\sigma
        \end{pmatrix}
        \biggl| \psi_0 \biggr\rangle
        =
        \begin{pmatrix}
            I^+_\omega      & F^{\mL+}_\omega \\
            F^{\mR+}_\omega & G^+_\omega
        \end{pmatrix} \\
        C^-_\omega
         & =
        \biggl\langle \psi_0 \biggr|
        \begin{pmatrix}
            q^\dag_\sigma \\
            d^\dag_\sigma
        \end{pmatrix}
        \frac{1}{\omega + H - E_0}
        \begin{pmatrix}
            q^{\pdag}_\sigma & d^{\pdag}_\sigma
        \end{pmatrix}
        \biggl| \psi_0 \biggr\rangle
        =
        \begin{pmatrix}
            I^-_\omega      & F^{\mR-}_\omega \\
            F^{\mL-}_\omega & G^-_\omega
        \end{pmatrix}
    \end{align}
\end{subequations}

\section{DMFT}

\begin{itemize}
    \item Bethe lattice
\end{itemize}

\section{Configuration interaction}
